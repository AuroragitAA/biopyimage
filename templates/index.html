<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wolffia Bioimage Analysis Dashboard</title>
<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <!-- Enhanced CSS Framework -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    
    <style>

    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ”¬ Wolffia Bioimage Analysis</h1>
            <p>Advanced automated cell counting, morphological analysis, and biomass estimation for Wolffia specimens</p>
        </div>

        <!-- Main Content Grid -->
        <div class="main-grid">
            <!-- Control Panel -->
            <div class="control-panel">
                <!-- File Upload -->
                <div class="control-section">
                    <h3>ğŸ“ Image Upload</h3>
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">ğŸ“·</div>
                        <p><strong>Drop images here</strong></p>
                        <p>or click to browse</p>
                        <p style="font-size: 0.8rem; color: #a1a1aa; margin-top: 10px;">
                            Supported: JPG, PNG, TIF, BMP
                        </p>
                        <input type="file" id="fileInput" accept=".jpg,.jpeg,.png,.tif,.tiff,.bmp,.jfif" multiple style="display: none;">
                    </div>
                </div>

                <!-- Analysis Parameters -->
                <div class="control-section">
                    <h3>âš™ï¸ Parameters</h3>
                    <div class="param-group">
                        <div class="param-input">
                            <label>Pixel to Micron Ratio</label>
                            <input type="number" id="pixelRatio" value="1.0" step="0.1" min="0.1">
                        </div>
                        <div class="param-input">
                            <label>Chlorophyll Threshold</label>
                            <input type="number" id="chlorophyllThreshold" value="0.6" step="0.1" min="0" max="1">
                        </div>
                        <div class="param-input">
                            <label>Min Cell Area (px)</label>
                            <input type="number" id="minCellArea" value="30" min="1">
                        </div>
                        <div class="param-input">
                            <label>Max Cell Area (px)</label>
                            <input type="number" id="maxCellArea" value="8000" min="100">
                        </div>
                    </div>
                </div>

                <!-- Analysis Method -->
                <div class="control-section">
                    <h3>ğŸ¯ Analysis Method</h3>
                    <div class="param-input">
                        <select id="analysisMethod">
                            <option value="auto">Auto Segmentation</option>
                            <option value="watershed">Watershed</option>
                            <option value="color">Color-based</option>
                        </select>
                    </div>
                    
                    <div id="colorMethods" class="color-methods" style="display: none;">
                        <div class="color-method" data-color="green_wolffia">
                            <strong>ğŸŸ¢ Green Wolffia</strong>
                            <div style="font-size: 0.8rem; color: #a1a1aa;">Standard chlorophyll</div>
                        </div>
                        <div class="color-method" data-color="pink_cells">
                            <strong>ğŸŒ¸ Pink Cells</strong>
                            <div style="font-size: 0.8rem; color: #a1a1aa;">Fluorescent markers</div>
                        </div>
                        <div class="color-method" data-color="blue_cells">
                            <strong>ğŸ”µ Blue Cells</strong>
                            <div style="font-size: 0.8rem; color: #a1a1aa;">DAPI staining</div>
                        </div>
                        <div class="color-method" data-color="purple_nuclei">
                            <strong>ğŸŸ£ Purple Nuclei</strong>
                            <div style="font-size: 0.8rem; color: #a1a1aa;">Nuclear stains</div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <button class="btn" id="analyzeBtn" disabled>
                        <span>ğŸ”</span> Analyze Image
                    </button>
                    <button class="btn btn-secondary" id="batchBtn" disabled>
                        <span>ğŸ“Š</span> Batch Analysis
                    </button>
                    <button class="btn" id="exportBtn" disabled style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                        <span>ğŸ’¾</span> Export Results
                    </button>
                </div>
            </div>

            <!-- Analysis Results Area -->
            <div class="analysis-area">
                <div class="analysis-tabs">
                    <div class="tab active" data-tab="overview">ğŸ“Š Overview</div>
                    <div class="tab" data-tab="details">ğŸ“‹ Details</div>
                    <div class="tab" data-tab="visualization">ğŸ¨ Visualization</div>
                </div>

                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div style="text-align: center; color: #a1a1aa;" id="progressText">
                        Initializing analysis...
                    </div>
                </div>

                <!-- Overview Tab -->
                <div class="tab-content active" id="overviewTab">
                    <div class="stats-grid" id="statsGrid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalCells">-</div>
                            <div class="stat-label">Total Cells</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avgArea">-</div>
                            <div class="stat-label">Avg Area (Î¼mÂ²)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalBiomass">-</div>
                            <div class="stat-label">Biomass Est.</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="chlorophyllRatio">-</div>
                            <div class="stat-label">High Chlorophyll %</div>
                        </div>
                    </div>

                    <div class="image-display" id="imageDisplay">
                        <p style="color: #a1a1aa;">ğŸ“· Upload an image to begin analysis</p>
                    </div>
                </div>

                <!-- Details Tab -->
                <div class="tab-content" id="detailsTab">
                    <div class="results-table" id="resultsTable" style="display: none;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Cell ID</th>
                                    <th>Area (Î¼mÂ²)</th>
                                    <th>Perimeter</th>
                                    <th>Chlorophyll</th>
                                    <th>Classification</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody"></tbody>
                        </table>
                    </div>
                    <div id="noDetailsMessage">
                        <p style="text-align: center; color: #a1a1aa; padding: 50px;">
                            ğŸ“‹ Detailed results will appear here after analysis
                        </p>
                    </div>
                </div>

                <!-- Visualization Tab -->
                <div class="tab-content" id="visualizationTab">
                    <div id="visualizations" style="display: none;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div style="text-align: center;">
                                <h4 style="color: #22c55e; margin-bottom: 15px;">Original Image</h4>
                                <canvas id="originalCanvas" style="max-width: 100%; border-radius: 10px;"></canvas>
                            </div>
                            <div style="text-align: center;">
                                <h4 style="color: #22c55e; margin-bottom: 15px;">Segmented Cells</h4>
                                <canvas id="segmentedCanvas" style="max-width: 100%; border-radius: 10px;"></canvas>
                            </div>
                        </div>
                    </div>
                    <div id="noVisualizationMessage">
                        <p style="text-align: center; color: #a1a1aa; padding: 50px;">
                            ğŸ¨ Visualization will appear here after analysis
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis History -->
        <div class="history-panel">
            <h3 style="color: #22c55e; margin-bottom: 20px;">ğŸ“ˆ Analysis History</h3>
            <div id="historyList">
                <p style="text-align: center; color: #a1a1aa; padding: 20px;">
                    ğŸ“ Your analysis history will appear here
                </p>
            </div>
        </div>



                <!-- New Tabs -->
        <div class="analysis-tabs">
            <div class="tab" data-tab="ml">ğŸ¤– ML Feedback</div>
            <div class="tab" data-tab="system">ğŸŒ System Status</div>
            <div class="tab" data-tab="qc">ğŸ“‹ QC Report</div>
            <div class="tab" data-tab="exports">ğŸ’¾ Exports</div>
        </div>

        <!-- ML Feedback Panel -->
        <div class="tab-content" id="mlTab">
            <div id="mlFeedback" class="info-panel">No ML feedback yet.</div>
            <button class="btn btn-secondary mt-2" id="trainMLBtn">ğŸ“ Train ML Models</button>
        </div>

        <!-- System Status Panel -->
        <div class="tab-content" id="systemTab">
            <div id="systemStatus" class="info-panel">Checking system...</div>
        </div>

        <!-- QC Report Panel -->
        <div class="tab-content" id="qcTab">
            <div id="qcReport" class="info-panel">No QC report available.</div>
        </div>

        <!-- Export Panel -->
        <div class="tab-content" id="exportsTab">
            <button class="btn mt-2" id="refreshExportsBtn">ğŸ”„ Refresh Export List</button>
            <ul id="exportList" class="export-list mt-3"></ul>
        </div>



    </div>




    <!-- Notification -->
    <div class="notification" id="notification">
        Analysis complete! ğŸ‰
    </div>
<script src="{{ url_for('static', filename='main_enhanced.js') }}"></script>
<script src="{{ url_for('static', filename='main.js') }}"></script>
</body>
</html>